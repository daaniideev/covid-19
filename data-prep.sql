----------------------------------------------------------------------------------WE IMPORT A DATA SET FROM 'EL INSTITUTO DE SALUD CARLOS III --(https://cnecovid.isciii.es/)----------------------------------------------------------------------------------------------------------------------------------------------------------------SELECT * FROM DATOS_COVID_ESPAÑA;--SOME DATA:--BU	NC	10-19	01/01/20	0	0	0	0--BU	NC	20-29	01/01/20	0	0	0	0--BU	NC	30-39	01/01/20	0	0	0	0------------------------------------------------------------------------------------------------------------------------------------------------------------------AS THE FIRST COLUMN HAS THE ISO CODIFICATION OF THE PROVINCES FROM SPAIN, WE--NEED TO GET A DATASET WITH THE ISO CODIFICATIONS OF THE PROVINCES FROM SPAIN --AND ITS DESCRIPTIONS (https://github.com/miguel-angel-monjas/spain-datasets/blob/master/data/ISO%203166-2.csv:--------------------------------------------------------------------------------select * from lookup_location;--SOME DATA:--provincia	ES-A	Alicante/Alacant	ES-VC--provincia	ES-AB	Albacete	ES-CM--provincia	ES-AL	Almería	ES-AN------------------------------------------------------------------------------------------------------------------------------------------------------------------AS 'lookup_location' HAS DIFFERENT CATEGORIES (PROVINCIA, CCAA, or ciudad --autonoma) WE CREATE THREE DIFFERENT TABLES WITH ITS INFORMATION.SELECT distinct CATEGORIA_DE_SUBDIVISION FROM lookup_location;--SOME DATA:--provincia--comunidad autónoma--ciudad autónoma------------------------------------------------------------------------------------------------------------------------------------------------------------------CREATION OF LOOKUP_CCAA:CREATE TABLE LOOKUP_CCAA AS SELECT     SUBSTR(CODIGO_3166_2, 4) as CCAA_ISO, --PARA ADAPTARLO A LA TABLA DATOS_COVID_ESPAÑA    NOMBRE_DE_LA_SUBDIVISION AS CCAA_NAME FROM     lookup_location WHERE     CATEGORIA_DE_SUBDIVISION = 'comunidad autónoma';----------------------------------------------------------------------------------------------------------------------------------------------------------------SELECT * fROM LOOKUP_CCAA;--SOME DATA:--AN	Andalucía--AR	Aragón--AS	Principado de Asturias------------------------------------------------------------------------------------------------------------------------------------------------------------------CREATION OF LOOKUP_PROVINCES:CREATE TABLE LOOKUP_PROVINCES AS SELECT     SUBSTR(CODIGO_3166_2, 4) as PROVINCE_ISO, --PARA ADAPTARLO A LA TABLA DATOS_COVID_ESPAÑA,    SUBSTR(SUBDIVISION_PADRE, 4) as CC_AA_ISO, --PARA ADAPTARLO A LA TABLA DATOS_COVID_ESPAÑA,    NOMBRE_DE_LA_SUBDIVISION AS PROVINCE_NAMEFROM     lookup_location WHERE     CATEGORIA_DE_SUBDIVISION = 'provincia';----------------------------------------------------------------------------------------------------------------------------------------------------------------SELECT * fROM LOOKUP_PROVINCES;--SOME DATA:--A	    VC	Alicante/Alacant--AB	CM	Albacete--AL	AN	Almería------------------------------------------------------------------------------------------------------------------------------------------------------------------CREATION OF LOOKUP_CIU_AUTCREATE TABLE LOOKUP_CIU_AUT AS SELECT     SUBSTR(CODIGO_3166_2, 4) as CCAA_ISO, --PARA ADAPTARLO A LA TABLA DATOS_COVID_ESPAÑA    NOMBRE_DE_LA_SUBDIVISION AS CCAA_NAME FROM     lookup_location WHERE     CATEGORIA_DE_SUBDIVISION = 'ciudad autónoma';----------------------------------------------------------------------------------------------------------------------------------------------------------------SELECT * fROM LOOKUP_CIU_AUT;--SOME DATA:--SOME DATA:--CE	Ceuta--ML	Melilla------------------------------------------------------------------------------------------------------------------------------------------------------------------CREATION OF LOOKUP_GENDER:CREATE TABLE LOOKUP_GENDER AS     SELECT 'NC' as SEX_ID, 'No especificado' as "SEX_DESCRIPTION" from dual union all    SELECT 'H' as SEX_ID, 'Man' as "SEX_DESCRIPTION"  from dual union all    SELECT 'M' as SEX_ID, 'WomAn' as "SEX_DESCRIPTION"  from dual;------------------------------------------------------------------------------------------------------------------------------------------------------------------1. GETTING THE TOTAL_CASES, TOTAL_DEATHS AND DEATH_PERCENTAGE IN SPAIN UNTIL MARÇ 2022 :SELECT     SUM(NUM_CASOS) AS TOTAL_CASES,     SUM(NUM_DEF) AS TOTAL_DEATHS,    (SUM(NUM_DEF)/SUM(NUM_CASOS))*100 AS DEATH_PERCENTAGEFROM             DATOS_COVID_ESPAÑA;--DATA:--11585578	104156	0,8990142744712434718405935379313833112168--------------------------------------------------------------------------------		----------------------------------------------------------------------------------2. GETTING THE TOTAL DEATHS PER PROVINCE:SELECT     PROVINCE_NAME PROVINCE,    SUM(NUM_DEF) TOTAL_DEATHS FROM     DATOS_COVID_ESPAÑA COV,    LOOKUP_PROVINCES PROVWHERE     COV.PROVINCIA_ISO = PROV.PROVINCE_ISOGROUP BY     PROVINCE_NAMEORDER BY     TOTAL_DEATHS DESC;--SOME DATA:--Madrid	19352--Barcelona	14601--Valencia/València	4610------------------------------------------------------------------------------------------------------------------------------------------------------------------3. GETTING THE TOTAL DEATHS PER CCAA:SELECT     CCAA_NAME CC_AA,    SUM(NUM_DEF) TOTAL_DEATHS FROM     DATOS_COVID_ESPAÑA COV,    LOOKUP_PROVINCES PROV,    LOOKUP_CCAA CCAAWHERE 1 = 1    AND COV.PROVINCIA_ISO = PROV.PROVINCE_ISO    AND PROV.CC_AA_ISO = CCAA.CCAA_ISOGROUP BY     CCAA_NAMEORDER BY     TOTAL_DEATHS DESC;--SOME DATA:--Comunidad de Madrid	19352--Cataluña	18867--Andalucía	13361------------------------------------------------------------------------------------------------------------------------------------------------------------------4.GETTING THE DEATH PERCENTAGE OF DEATHS OUT OF THE TOTAL NUMBER OF INFECTED PER CCAA:SELECT     CCAA_NAME CC_AA,    SUM(NUM_CASOS) TOTAL_CASES,    SUM(NUM_DEF) TOTAL_DEATHS,    ROUND((SUM(NUM_DEF)/SUM(NUM_CASOS))*100,2) AS DEATH_PERCENTAGEFROM     DATOS_COVID_ESPAÑA COV,    LOOKUP_PROVINCES PROV,    LOOKUP_CCAA CCAAWHERE 1 = 1    AND COV.PROVINCIA_ISO = PROV.PROVINCE_ISO    AND PROV.CC_AA_ISO = CCAA.CCAA_ISOGROUP BY     CCAA_NAMEORDER BY     DEATH_PERCENTAGE DESC;--SOME DATA:--Castilla-La Mancha	    496875	7155	1,44--Principado de Asturias	206528	2603	1,26--Castilla y León	        661457	8323	1,26------------------------------------------------------------------------------------------------------------------------------------------------------------------5.GETTING THE DEATH PERCENTAGE OF DEATHS OUT OF THE TOTAL NUMBER OF INFECTED PER CCAA AND PER GENDER:SELECT     SEXO,    SUM(NUM_CASOS) TOTAL_CASES,    SUM(NUM_DEF) TOTAL_DEATHS,    ROUND((SUM(NUM_DEF)/SUM(NUM_CASOS))*100,2) AS DEATH_PERCENTAGEFROM     DATOS_COVID_ESPAÑA COV,    LOOKUP_PROVINCES PROV,    LOOKUP_CCAA CCAAWHERE 1 = 1    AND COV.PROVINCIA_ISO = PROV.PROVINCE_ISO    AND PROV.CC_AA_ISO = CCAA.CCAA_ISO    AND SEXO IN ('H', 'M')GROUP BY SEXO;--DATA:--H	5412707	57237	1,06--M	6089506	46120	0,76------------------------------------------------------------------------------------------------------------------------------------------------------------------6.GETTING THE DEATH PERCENTAGE OF DEATHS OUT OF THE TOTAL NUMBER OF INFECTED PER AGE GROUP:SELECT     GRUPO_EDAD,    SUM(NUM_CASOS) TOTAL_CASES,    SUM(NUM_DEF) TOTAL_DEATHS,    ROUND((SUM(NUM_DEF)/SUM(NUM_CASOS))*100,2) AS DEATH_PERCENTAGEFROM     DATOS_COVID_ESPAÑA COV,    LOOKUP_PROVINCES PROV,    LOOKUP_CCAA CCAAWHERE 1 = 1    AND COV.PROVINCIA_ISO = PROV.PROVINCE_ISO    AND PROV.CC_AA_ISO = CCAA.CCAA_ISOGROUP BY     GRUPO_EDADORDER BY     DEATH_PERCENTAGE DESC;----------------------------------------------------------------------------------DATA:--80+	531702	65132	12249,72--70-79	547830	22162	4045,42--60-69	864543	10446	1208,27--NC	3650	23	    630,14--50-59	1494695	3972	265,74--40-49	2091483	1156	55,27--30-39	1763233	348	    19,74--20-29	1622947	137	    8,44--0-9	1062463	24	    2,26--10-19	1522655	27	    1,77----------------------------------------------------------------------------------------------------------------------------------------------------------------------7.GETTING THE MONTHLY COMULATIVE TOTAL OF DEATHS PER CCAA:SELECT     CCAA_NAME,    MES_ANIO,    SUM(DEFUNCIONES) OVER (PARTITION BY CCAA_NAME ORDER BY TO_DATE(MES_ANIO,'MM/YYYY')) AS TOTAL_DEATHSFROM     (SELECT         CCAA_NAME,        TO_CHAR(FECHA, 'MM/YYYY') AS MES_ANIO,        SUM(NUM_DEF) AS DEFUNCIONES    FROM             DATOS_COVID_ESPAÑA COV,        LOOKUP_PROVINCES PROV,        LOOKUP_CCAA CCAA    WHERE 1 = 1        AND COV.PROVINCIA_ISO = PROV.PROVINCE_ISO        AND PROV.CC_AA_ISO = CCAA.CCAA_ISO    GROUP BY         CCAA_NAME,        TO_CHAR(FECHA, 'MM/YYYY')    ORDER BY            CCAA_NAME,        TO_DATE(TO_CHAR(FECHA, 'MM/YYYY'), 'MM/YYYY'))--SOME DATA:--Andalucía	01/2020	0--Andalucía	02/2020	0--Andalucía	03/2020	465--Andalucía	04/2020	1299----------------------------------------------------------------------------------------------------------------------------------------------------------------------8.GETTING THE PERCENT OF DEATHS PER GROUP AGE OF THE TOTAL DEATHS:SELECT      GRUPO_EDAD,    (A.DEATHS_PER_AGE/B.TOTAL_DEATHS)*100 AS PERCENTFROM    (SELECT         GRUPO_EDAD, SUM(NUM_DEF) DEATHS_PER_AGE    FROM        DATOS_COVID_ESPAÑA    GROUP BY         GRUPO_EDAD) A,    (SELECT         SUM(NUM_DEF) AS TOTAL_DEATHS    FROM        DATOS_COVID_ESPAÑA) BWHERE 1 = 1--SOME DATA:--0-9	0,0230423595376166519451591843004723683705--10-19	0,0259226544798187334383040823380314144168--20-29	0,1334536656553631091823802757402358001459--30-39	0,3379546065517108951956680364069280694343--40-49	1,12235492914474442182879526863550827605--50-59	3,85191443603825031683244364222896424594--60-69	10,11079534544337340143630707784477130458--70-79	21,40155151887553285456430738507623180614--80+	62,79427013326164599254963708283728253773--NC	0,1987403510119436230269979645915741771957----------------------------------------------------------------------------------